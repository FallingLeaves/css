# css 世界的层叠规则 [demo](https://fallingleaves.github.io/css-world/page/第七章-css世界的层叠规则.html)

## 1. z-Index 只是 css 世界层叠规则中的一叶小舟

> z-Index 只能作用定位元素和 flex 布局的子元素，而页面中多数是非定位元素

## 2. css 世界的层叠上下文和层叠水平

* 层叠上下文：HTML 中的三维概念，如果一个元素有层叠上下文，就说该元素在 z 轴高人一等。层叠上下文可以理解为层叠结界，自成一个小世界，这个小世界可能包含其他的层叠结界，或包含在其他层叠结界中
* 层叠水平：决定了同一个层叠上下文中，元素在 z 轴上的显示顺序。普通元素的层叠水平探讨只考虑当前层叠上下文，因为普通元素的层叠水平无法突破层叠结界和结界外的元素比较层叠水平
* 层叠顺序：表示元素发生层叠时，有着特定的垂直显示顺序。css3 前的层叠顺序规则:
  <img src="./img/层叠顺序规则.png">
  补充：
  1.  位于最下面的 background/border 特指层叠上下文元素的边框和背景色。每一个层叠顺序规则仅适用于当前层叠上下文元素的小世界。
  2.  inline 水平盒子指的是包括 inline/inline-block/inline-table 元素的“层叠顺序”，它们都是同等级别的。
  3.  单纯从层叠水平上看，实际上 z-index:0 和 z-index:auto 是可以看成是一样的。注意这里的措辞—“单纯从层叠水平上看”，实际上，两者在层叠上下文领域有着根本性的差异。

## 3. 层叠准则

1.  谁大谁上：当明显的层叠水平标识时，如生效的 z-index，在同一个层叠上下文领域，层叠水平大的覆盖小的。
2.  后来居上：当元素的层叠水平一致，处于同一层叠顺序时，DOM 流后面的覆盖前面的。

## 4. 层叠上下文的特性

1.  层叠上下文的层叠水平比普通元素高。
2.  层叠上下文可以阻断元素的混合模式。
3.  层叠上下文可以嵌套，内部层叠上下文及其所有子元素受制于外部的层叠上下文。
4.  每个层叠上下文与兄弟元素独立。
5.  每个层叠上下文是自成体系的，当元素发生层叠时，整个元素被认为是在父层叠上下文的层叠顺序中。

## 5. 层叠上下文的创建

* 天生派，页面根元素天生具有层叠上下文，称为根层叠上下文。
* 正统派，z-index 为数值的定位元素的传统层叠上下文。
* 扩招派，其他 css3 属性。
  1.  元素为 flex 布局，同时 z-index 不为 auto。
  2.  元素的 opacity 值不为 1。
  3.  元素的 transform 的值不为 none。
  4.  元素 mix-blend-mode 值不是 normal。
  5.  元素的 filter 值不是 none。
  6.  元素的 isolation 值是 isolate。
  7.  元素的 will-change 属性值为上面 2 ～ 6 的任意一个（如 will-change:opacity、will-chang:transform 等）。
  8.  元素的-webkit-overflow-scrolling 设为 touch。

## 6. 层叠上下文与层叠顺序

1.  如果层叠上下文元素不依赖 z-index 数值，则其层叠顺序是 z-index:auto，可看成 z:index:0 级别；
2.  如果层叠上下文元素依赖 z-index 数值，则其层叠顺序由 z-index 值决定。
    <img src="./img/新的层叠顺序.png">

## 7. z-Index 的负值

> z-index 负值渲染的过程就是一个寻找第一个层叠上下文元素的过程，然后层叠顺序止步于这个层叠上下文元素。可以做可访问性隐藏、ie8 模拟多背景（利用伪类最多 3 个）

## 8. z-Index 不犯二准则

* 对于非浮层元素，避免设置 z-index 值，z-index 值没有任何道理需要超过 2。（不包括那些在页面上飘来飘去的元素定位，弹框、出错提示、一些下拉效果等都不受这一准则限制）。
* 定位元素一旦设置 z-index，就从普通定位元素变成层叠上下文元素，相互间的层叠顺序发生根本变化，避免 z-index 一山比一山高的样式混乱问题。
